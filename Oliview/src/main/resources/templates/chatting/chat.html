<!DOCTYPE html>
<html lang="kor" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>talk chat</title>
  <link rel="stylesheet" href="/css/chatting/chat.css">
  <script src="https://kit.fontawesome.com/39f6050202.js" crossorigin="anonymous"></script>
  <th:block th:replace="~{common/common}"></th:block>
</head>
<body>
 <main>
    <!-- header -->
    <th:block th:replace="~{common/header}"></th:block>

    <div class="con">

      <!-- 채팅목록-->
      <div class="con2">

        <div class="title">
          <h1>대화 목록</h1>
        </div>

        <!-- 채팅멤버 추가 팝업 -->
        <div id="addTargetPopupLayer" class="popup-layer-close">  
        </div>

        <!-- 채팅 목록 -->
        <div class="chatting-area">

          <ul class="chatting-list">
            <th:block th:each="room : ${roomList}">

              <!-- th:chat-no : li 태그에 임의의 속성 chat-no를 추가,
  		  				타임리프를 이용해 출력된 값을 chat-no 속성 값으로 대입 -->
              <li class="chatting-item" th:chat-no="*{room.chattingNo}">

                <div class="item-header">
                  <!-- 채팅 프로필 있는경우 / 없는경우 -->
                  <!-- <img th:if="${room.targetProfile}" class="boardImg" th:src="${room.targetProfile}" width="80rem" height="80rem">
                  <img th:unless="${room.targetProfile}" class="boardImg" th:src="#{user.default.image}" width="80rem" height="80rem"> -->
                </div>

                <div class="item-body">
                  <p class="profile"> <!-- div->p로 js때문에 수정함 -->
                    <span class="boardTitle" th:text="${room.boardTitle}">게시글 제목</span>
                    <p class="recent-message" th:text="${room.lastMessage}">메세지 내용</p>
                  </p>
                  
                  <div class="chat-status">
                    <span class="recent-send-time" th:text="${room.sendTime}">메세지 보낸 시간</span>
                    <p th:if="${room.notReadCount > 0}" class="not-read-count" th:text="${room.notReadCount}"></p>
                  </div>
                </div>
              </li>
            </th:block>
          </ul>
        </div>
      </div>
    </div>

  </main>
  
  <!-- footer -->
  <th:block th:replace="~{common/footer}"></th:block>

  <!-- sockjs를 이용한 WebSocket 구현을 위해 라이브러리 추가 -->
  <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>

	<script th:inline="javascript">

    // 로그인한 회원 번호
		const loginMemberNo = /*[[${session.loginMember.memberNo}]]*/ '로그인한 회원번호';

    // 같이먹어요에서 클릭해온 회원 번호??

    const loginMember = /*[[${session.loginMember}]]*/ '로그인회원';

    let selectChattingNo = /*[[${session.together?.boardNo}]]*/ '채팅방번호(같이먹어요 게시글번호)';
    
		const userDefaultImage = /*[[#{user.default.image}]]*/ '프로필 기본 이미지' ;
	</script>

  <script src="/js/chatting/chat.js"></script>

</body>

</html>